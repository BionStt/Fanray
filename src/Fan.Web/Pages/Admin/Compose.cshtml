@page "{postId:int?}"
@model Fan.Web.Pages.Admin.ComposeModel
@{
    ViewData["Title"] = "Compose";
    Layout = null;
    var coreSettings = await settingService.GetSettingsAsync<CoreSettings>();
}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
    <title>@ViewData["Title"] - Fanray</title>
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Material+Icons" rel="stylesheet">
    <link href="https://unpkg.com/vuetify@1.1.4/dist/vuetify.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/quill/1.3.6/quill.snow.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="~/themes/@coreSettings.Theme/css/editor.min.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/admin/css/compose.css" asp-append-version="true" />
</head>
<body>
    @Html.AntiForgeryToken()

    <div id="app" v-cloak>
        <v-app id="inspire" style="background-color:white">
            @* Drawer *@
            <v-navigation-drawer fixed
                                 :clipped="$vuetify.breakpoint.mdAndUp"
                                 app
                                 v-model="drawer">
                <div style="padding: 5px">
                    <v-card v-if="published" style="margin-bottom:8px">
                        <v-container fill-height
                                     fluid
                                     pa-0>
                            <v-layout fill-height>
                                <v-flex xs12 align-end flexbox>
                                    <div class="caption" style="color:#666">Status</div>
                                    <div style="text-align:center;font-size:inherit">
                                        <span style="color:teal;padding-right: 5px;font-weight:bold">Published</span><span>on 2018-09-06</span>
                                    </div>
                                </v-flex>
                            </v-layout>
                        </v-container>
                        <v-card-actions>
                            <v-btn small
                                   style="width:100%"
                                   color="grey darken-2"
                                   class="white--text"
                                   @@click="revert">
                                <v-icon left dark>undo</v-icon>
                                Revert to draft
                            </v-btn>
                        </v-card-actions>
                    </v-card>

                    <v-menu ref="menuDate"
                            :close-on-content-click="false"
                            v-model="menuDate"
                            :return-value.sync="date"
                            lazy
                            transition="scale-transition"
                            offset-y
                            full-width
                            @@input="onFieldsChange">
                        <v-text-field label="Date"
                                      slot="activator"
                                      v-model="date"
                                      readonly></v-text-field>
                        <v-date-picker v-model="date"
                                       no-title
                                       scrollable
                                       @@input="$refs.menuDate.save(date)"></v-date-picker>
                    </v-menu>

                    <v-select label="Category"
                              v-model="selectedCatId"
                              :items="cats"
                              item-value="value"
                              dense
                              @@input="onFieldsChange"></v-select>

                    <v-combobox label="Tags"
                                hint="When you type in a new tag use tab to delimit."
                                v-model="selectedTags"
                                :items="tags"
                                dense
                                multiple
                                small-chips
                                deletable-chips
                                @@input="onFieldsChange"></v-combobox>

                    <v-text-field label="Slug"
                                  v-model="slug"
                                  @@input="onFieldsChange"></v-text-field>

                    <v-textarea label="Excerpt"
                                v-model="excerpt"
                                auto-grow
                                @@input="onFieldsChange"></v-textarea>

                    <v-card flat
                            style="margin-bottom:8px">
                        <v-card-actions>
                            <v-btn small
                                   style="width:100%"
                                   color="grey darken-2"
                                   class="white--text">
                                <v-icon left dark>delete_forever</v-icon>
                                Delete post
                            </v-btn>
                        </v-card-actions>
                    </v-card>
                </div>
            </v-navigation-drawer>
            @* Topbar *@
            <v-toolbar color="blue darken-3"
                       dark
                       app
                       :clipped-left="$vuetify.breakpoint.mdAndUp"
                       fixed>
                <v-toolbar-side-icon @@click.stop="drawer = !drawer"></v-toolbar-side-icon>
                <v-btn @@click="pub" :disabled="disablePubButton" color="orange">{{ pubText }}</v-btn>
                <v-btn>Preview</v-btn>
                <v-btn @@click="saveDraft" flat small v-if="showSave" :disabled="disableSave" color="orange">{{ saveText }}</v-btn>
                <v-spacer></v-spacer>
                <v-btn href="/admin">Close</v-btn>
            </v-toolbar>
            @* Editor *@
            <v-content>
                <div id="editor-area">
                    <v-text-field id="post-title"
                                  label="Title"
                                  v-model="title"
                                  placeholder="Title"
                                  solo
                                  height="70px"
                                  multip
                                  @@input="onFieldsChange"
                                  @@change="saveDraft"></v-text-field>
                    <div id="editor"></div>
                </div>
            </v-content>
            <v-dialog v-model="showMediaDialog" lazy max-width="80%">
                <v-card>
                    <v-card-text>
                        <div>
                            <v-toolbar class="elevation-0">
                                <v-btn flat @@click="uploadImages">
                                    <v-icon color="primary">cloud_upload</v-icon>
                                    &nbsp;Upload
                                </v-btn>
                            </v-toolbar>
                            <v-divider></v-divider>
                            <div class="gallery">
                                <a v-for="image in images" :key="image.id" @@click="insertImage(image.url)">
                                    <img :src="image.url" :alt="image.fileName">
                                </a>
                            </div>
                        </div>
                    </v-card-text>
                    <v-card-actions>
                        <v-btn color="primary" flat @@click.stop="showMediaDialog=false">Close</v-btn>
                    </v-card-actions>
                </v-card>
            </v-dialog>
        </v-app>
    </div>
    <environment include="Development">
        <script src="https://unpkg.com/vue@2.5.16/dist/vue.js"></script>
        <script src="https://unpkg.com/vuetify@1.1.4/dist/vuetify.js"></script>
    </environment>
    <environment exclude="Development">
        <script src="https://unpkg.com/vue@2.5.16/dist/vue.min.js"></script>
        <script src="https://unpkg.com/vuetify@1.1.4/dist/vuetify.min.js"></script>
    </environment>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="https://unpkg.com/quill@1.3.6/dist/quill.min.js"></script>
    <script src="https://unpkg.com/axios@0.18.0/dist/axios.min.js"></script>
    <script src="~/lib/quill-image-resize-module/image-resize.min.js"></script>
    <script src="~/admin/js/compose.js" asp-append-version="true"></script>
</body>
</html>