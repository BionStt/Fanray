{"version":3,"sources":["../../../Areas/Admin/js/blog-compose.js"],"names":["app","Vue","el","data","id","published","isDraft","pubClicked","pubText","saveVisible","saveDisabled","saveText","closing","fieldChanged","drawer","panel","menuDate","date","draftDate","selectedCatId","cats","selectedTags","tags","slug","excerpt","title","mediaDialogVisible","progressVisible","editor","content","snackbar","show","text","color","computed","disablePubButton","trim","length","tok","document","querySelector","value","headers","payload","postDate","categoryId","body","getData","mounted","initEditor","methods","window","location","href","substring","lastIndexOf","self","axios","get","then","resp","post","allCats","allTags","typingTimer","ClassicEditor","create","autosave","save","clearTimeout","setTimeout","saveDraft","catch","onFieldsChange","endsWith","history","replaceState","revert","pub","url","replace","insertImages","images","imgsHtml","i","urlMedium","alt","caption","viewFragment","processor","toView","modelFragment","toModel","model","insertContent","selection","titleEnter","toast","toastError"],"mappings":"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","sourcesContent":["ï»¿/**\r\n * The js code for Compose.cshtml.\r\n */\r\nvar app = new Vue({\r\n    el: '#app',\r\n    data: () => ({\r\n        id: 0,\r\n        published: false,\r\n        isDraft: false,\r\n        pubClicked: false,\r\n        pubText: '',\r\n        saveVisible: false,\r\n        saveDisabled: false,\r\n        saveText: 'Save',\r\n        closing: true,\r\n        fieldChanged: false,\r\n        drawer: null,\r\n        panel: [true, true, true],\r\n        menuDate: false,\r\n        date: '',\r\n        draftDate: '',\r\n        selectedCatId: 1,\r\n        cats: [],\r\n        selectedTags: [],\r\n        tags: [],\r\n        slug: '',\r\n        excerpt: '',\r\n        title: '',\r\n        mediaDialogVisible: false,\r\n        progressVisible: false,\r\n        editor: null,\r\n        content: '',\r\n        snackbar: {\r\n            show: false,\r\n            text: '',\r\n            color: '',\r\n        },\r\n    }),\r\n    computed: {\r\n        disablePubButton() {\r\n            return this.title.trim().length <= 0 || this.pubClicked;\r\n        },\r\n        tok: function () {\r\n            return document.querySelector('input[name=\"__RequestVerificationToken\"][type=\"hidden\"]').value;\r\n        },\r\n        headers() {\r\n            return { headers: { 'XSRF-TOKEN': this.tok } };\r\n        },\r\n        payload: function () {\r\n            return {\r\n                id: this.id,\r\n                postDate: this.date,\r\n                categoryId: this.selectedCatId,\r\n                tags: this.selectedTags,\r\n                slug: this.slug,\r\n                excerpt: this.excerpt,\r\n                title: this.title,\r\n                body: this.editor.getData(),\r\n            }\r\n        },\r\n    },\r\n    mounted() {\r\n        this.initEditor();\r\n    },\r\n    methods: {\r\n        initEditor() {\r\n            this.id = window.location.href.substring(window.location.href.lastIndexOf(\"/\") + 1) | 0;\r\n            let self = this;\r\n            axios.get(`/admin/compose?handler=post&postId=${this.id}`).then(resp => {\r\n                this.date = resp.data.post.postDate;\r\n                this.selectedCatId = resp.data.post.categoryId;\r\n                this.selectedTags = resp.data.post.tags;\r\n                this.slug = resp.data.post.slug;\r\n                this.excerpt = resp.data.post.excerpt;\r\n                this.title = resp.data.post.title;\r\n                this.content = resp.data.post.body;\r\n                this.published = resp.data.post.published;\r\n                this.isDraft = resp.data.post.isDraft;\r\n                this.draftDate = resp.data.post.draftDate;\r\n                this.cats = resp.data.allCats;\r\n                this.tags = resp.data.allTags;\r\n                this.pubText = this.published ? 'Update' : 'Publish';\r\n\r\n                let typingTimer;\r\n                let doneTypingInterval = 5000;\r\n\r\n                ClassicEditor.create(document.querySelector('#editor'), {\r\n                    autosave: {\r\n                        save(editor) {\r\n                            clearTimeout(typingTimer);\r\n                            if (!self.published) {\r\n                                self.saveVisible = true;\r\n                                self.saveDisabled = false;\r\n                                self.saveText = 'Save';\r\n                                typingTimer = setTimeout(self.saveDraft, doneTypingInterval);\r\n                            }\r\n                        }\r\n                    }\r\n                })\r\n                    .then(editor => {\r\n                        self.editor = editor;\r\n                        console.log('editor initialized: ', self.editor);\r\n                    })\r\n                    .catch(error => {\r\n                        console.error(error);\r\n                    });\r\n            });\r\n        },\r\n        onFieldsChange() {\r\n            this.fieldChanged = true;\r\n            if (this.published) return;\r\n            this.saveVisible = true;\r\n            this.saveDisabled = false;\r\n            this.saveText = 'Save';\r\n        },\r\n        saveDraft() {\r\n            console.log('save draft');\r\n            this.saveVisible = true;\r\n            this.saveDisabled = true;\r\n            this.saveText = 'Saving...';\r\n\r\n            console.log(this.payload);\r\n            axios.post('/admin/compose?handler=save', this.payload, { headers: { 'XSRF-TOKEN': this.tok } })\r\n                .then(resp => {\r\n                    this.id = resp.data.id;\r\n                    this.slug = resp.data.slug;\r\n                    this.draftDate = resp.data.draftDate;\r\n                    this.isDraft = true;\r\n                    if (window.location.href.endsWith('/compose'))\r\n                        history.replaceState({}, null, window.location.href + `/${this.id}`);\r\n                })\r\n                .catch(err => { console.log(err); });\r\n\r\n            this.fieldChanged = false;\r\n            this.saveText = 'Saved';\r\n        },\r\n        revert() {\r\n            this.published = false;\r\n            this.pubText = this.published ? 'Update' : 'Publish';\r\n            this.saveDraft();\r\n        },\r\n        pub() {\r\n            this.closing = false;\r\n            this.pubClicked = true;\r\n            this.pubText = this.published ? 'Updating...' : 'Publishing...';\r\n\r\n            const url = this.published ? '/admin/compose?handler=update' : '/admin/compose?handler=publish';\r\n            axios.post(url, this.payload, { headers: { 'XSRF-TOKEN': this.tok } })\r\n                .then(resp => {\r\n                    window.location.replace(resp.data);\r\n                })\r\n                .catch(err => { console.log(err); });\r\n        },\r\n        /**\r\n         * Inserts selected images to editor.\r\n         * https://docs.ckeditor.com/ckeditor5/latest/builds/guides/faq.html#where-are-the-editorinserthtml-and-editorinserttext-methods-how-to-insert-some-content\r\n         * https://docs.ckeditor.com/ckeditor5/latest/features/image.html#image-captions\r\n         */\r\n        insertImages(images) {\r\n            console.log(\"selected images to insert: \", images);\r\n            let imgsHtml = '';\r\n            for (var i = 0; i < images.length; i++) {\r\n                imgsHtml += `<figure class=\"image\"><img src=\"${images[i].urlMedium}\" alt=\"${images[i].alt}\" title=\"${images[i].title}\"><figcaption>${images[i].caption}</figcaption></figure>`;\r\n            }\r\n            const viewFragment = this.editor.data.processor.toView(imgsHtml);\r\n            const modelFragment = this.editor.data.toModel(viewFragment);\r\n            this.editor.model.insertContent(modelFragment, this.editor.model.document.selection);\r\n            this.mediaDialogVisible = false;\r\n        },\r\n        titleEnter() {\r\n            this.title = this.title.replace(/\\n/g, ' ');\r\n        },\r\n        toast(text, color = 'silver') {\r\n            this.snackbar.show = true;\r\n            this.snackbar.text = text;\r\n            this.snackbar.color = color;\r\n        },\r\n        toastError(text) {\r\n            this.snackbar.show = true;\r\n            this.snackbar.text = text;\r\n            this.snackbar.color = 'red';\r\n        },\r\n    },\r\n});\r\n"],"file":"blog-compose.js"}