{"version":3,"sources":["../../../Pages/Admin/client/js/blog-compose.js"],"names":["app","Vue","el","store","mixins","composeMixin","data","pubClicked","pubText","saveVisible","saveDisabled","saveText","closing","fieldChanged","drawer","panel","menuDate","mediaDialogVisible","previewUrl","postUrl","previewDialogVisible","progressVisible","editor","snackbar","show","text","color","computed","disablePubButton","post","title","trim","length","tok","document","querySelector","value","headers","payload","id","postDate","categoryId","tags","slug","excerpt","body","getData","selectedImages","$store","state","mounted","published","initEditor","methods","typingTimer","self","ClassicEditor","create","autosave","save","clearTimeout","setTimeout","saveDraft","autosaveInterval","then","catch","onFieldsChange","axios","resp","draftDate","isDraft","window","location","href","endsWith","history","replaceState","preview","replace","closePreview","revert","pub","url","insertImages","imgsHtml","forEach","img","urlMedium","alt","caption","selected","dispatch","viewFragment","processor","toView","modelFragment","toModel","model","insertContent","selection","closeMediaDialog","titleEnter","toast","toastError"],"mappings":"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","sourcesContent":["ï»¿var app = new Vue({\r\n    el: '#app',\r\n    store,\r\n    mixins: [composeMixin],\r\n    data: () => ({\r\n        pubClicked: false,\r\n        pubText: '',\r\n        saveVisible: false,\r\n        saveDisabled: false,\r\n        saveText: 'Save',\r\n        closing: true,\r\n        fieldChanged: false,\r\n        drawer: null,\r\n        panel: [true, true, true],\r\n        menuDate: false,\r\n        mediaDialogVisible: false,\r\n        previewUrl: null,\r\n        postUrl: null,\r\n        previewDialogVisible: false,\r\n        progressVisible: false,\r\n        editor: null,\r\n        snackbar: {\r\n            show: false,\r\n            text: '',\r\n            color: '',\r\n        },\r\n    }),\r\n    computed: {\r\n        disablePubButton() {\r\n            return this.post.title.trim().length <= 0 || this.pubClicked;\r\n        },\r\n        tok: function () {\r\n            return document.querySelector('input[name=\"__RequestVerificationToken\"][type=\"hidden\"]').value;\r\n        },\r\n        headers() {\r\n            return { headers: { 'XSRF-TOKEN': this.tok } };\r\n        },\r\n        payload: function () {\r\n            return {\r\n                id: this.post.id,\r\n                postDate: this.post.postDate,\r\n                categoryId: this.post.categoryId,\r\n                tags: this.post.tags,\r\n                slug: this.post.slug,\r\n                excerpt: this.post.excerpt,\r\n                title: this.post.title,\r\n                body: this.editor.getData(),\r\n            }\r\n        },\r\n        selectedImages() { // from store\r\n            return this.$store.state.selectedImages;\r\n        },\r\n    },\r\n    mounted() {\r\n        this.pubText = this.post.published ? 'Update' : 'Publish';\r\n        this.initEditor();\r\n    },\r\n    methods: {\r\n        initEditor() {\r\n            let typingTimer;\r\n            let self = this;\r\n            ClassicEditor.create(document.querySelector('#editor'), {\r\n                autosave: {\r\n                    save(editor) {\r\n                        clearTimeout(typingTimer);\r\n                        if (!self.post.published) {\r\n                            self.saveVisible = true;\r\n                            self.saveDisabled = false;\r\n                            self.saveText = 'Save';\r\n                            typingTimer = setTimeout(self.saveDraft, self.autosaveInterval);\r\n                        }\r\n                    }\r\n                }\r\n            })\r\n                .then(editor => {\r\n                    self.editor = editor;\r\n                    console.log('editor initialized: ', self.editor);\r\n                })\r\n                .catch(error => {\r\n                    console.error(error);\r\n                });\r\n        },\r\n        onFieldsChange() {\r\n            this.fieldChanged = true;\r\n            if (this.post.published) return;\r\n            this.saveVisible = true;\r\n            this.saveDisabled = false;\r\n            this.saveText = 'Save';\r\n        },\r\n        saveDraft() {\r\n            console.log('save draft');\r\n            this.saveVisible = true;\r\n            this.saveDisabled = true;\r\n            this.saveText = 'Saving...';\r\n\r\n            console.log('payload: ', this.payload);\r\n            axios.post('/admin/compose?handler=save', this.payload, { headers: { 'XSRF-TOKEN': this.tok } })\r\n                .then(resp => {\r\n                    this.post.id = resp.data.id;\r\n                    this.post.slug = resp.data.slug;\r\n                    this.post.draftDate = resp.data.draftDate;\r\n                    this.post.isDraft = true;\r\n                    if (window.location.href.endsWith('/compose'))\r\n                        history.replaceState({}, null, window.location.href + `/${this.post.id}`);\r\n                })\r\n                .catch(err => { console.log(err); });\r\n\r\n            this.fieldChanged = false;\r\n            this.saveText = 'Saved';\r\n        },\r\n        preview() {\r\n            this.previewDialogVisible = true;\r\n            this.payload.body = this.editor.getData();\r\n            axios.post('/admin/compose?handler=preview', this.payload, { headers: { 'XSRF-TOKEN': this.tok } })\r\n                .then(resp => {\r\n                    this.previewUrl = resp.data;\r\n                    this.postUrl = this.previewUrl.replace('preview/', '');\r\n                })\r\n                .catch(err => { console.log(err); });\r\n        },\r\n        closePreview() {\r\n            this.previewDialogVisible = false;\r\n            this.previewUrl = null;\r\n            this.postUrl = null;\r\n        },\r\n        revert() {\r\n            this.post.published = false;\r\n            this.pubText = this.post.published ? 'Update' : 'Publish';\r\n            this.saveDraft();\r\n        },\r\n        pub() {\r\n            this.closing = false;\r\n            this.pubClicked = true;\r\n            this.pubText = this.post.published ? 'Updating...' : 'Publishing...';\r\n\r\n            const url = this.post.published ? '/admin/compose?handler=update' : '/admin/compose?handler=publish';\r\n            axios.post(url, this.payload, { headers: { 'XSRF-TOKEN': this.tok } })\r\n                .then(resp => {\r\n                    window.location.replace(resp.data);\r\n                })\r\n                .catch(err => { console.log(err); });\r\n        },\r\n        /**\r\n         * Inserts selected images to editor.\r\n         * https://docs.ckeditor.com/ckeditor5/latest/builds/guides/faq.html#where-are-the-editorinserthtml-and-editorinserttext-methods-how-to-insert-some-content\r\n         * https://docs.ckeditor.com/ckeditor5/latest/features/image.html#image-captions\r\n         */\r\n        insertImages() {\r\n            let imgsHtml = '';\r\n            this.selectedImages.forEach(img => {\r\n                imgsHtml += `<figure class=\"image\"><img src=\"${img.urlMedium}\" alt=\"${img.alt}\" title=\"${img.title}\"><figcaption>${img.caption}</figcaption></figure>`;\r\n                img.selected = false; // remove the checkmark\r\n            });\r\n            this.$store.dispatch('emptySelectedImages'); // clear selectedImages so gallery buttons could hide\r\n            const viewFragment = this.editor.data.processor.toView(imgsHtml);\r\n            const modelFragment = this.editor.data.toModel(viewFragment);\r\n            this.editor.model.insertContent(modelFragment, this.editor.model.document.selection);\r\n            this.mediaDialogVisible = false;\r\n        },\r\n        closeMediaDialog() {\r\n            this.mediaDialogVisible = false;\r\n            this.selectedImages.forEach(img => img.selected = false ); // remove checkmarks\r\n            this.$store.dispatch('emptySelectedImages'); // clear selectedImages so gallery buttons could hide\r\n        },\r\n        titleEnter() {\r\n            this.post.title = this.post.title.replace(/\\n/g, ' ');\r\n        },\r\n        toast(text, color = 'silver') {\r\n            this.snackbar.show = true;\r\n            this.snackbar.text = text;\r\n            this.snackbar.color = color;\r\n        },\r\n        toastError(text) {\r\n            this.snackbar.show = true;\r\n            this.snackbar.text = text;\r\n            this.snackbar.color = 'red';\r\n        },\r\n    },\r\n});"],"file":"blog-compose.js"}