{"version":3,"sources":["../../../Pages/Admin/client/js/blog-compose.js"],"names":["app","Vue","el","mixins","blogComposeMixin","data","pubClicked","pubText","saveVisible","saveDisabled","saveText","closing","fieldChanged","drawer","panel","menuDate","mediaDialogVisible","previewUrl","postUrl","previewDialogVisible","progressVisible","editor","snackbar","show","text","color","computed","disablePubButton","post","title","trim","length","tok","document","querySelector","value","headers","payload","id","postDate","categoryId","tags","slug","excerpt","body","getData","mounted","published","initEditor","methods","typingTimer","self","ClassicEditor","create","autosave","save","clearTimeout","setTimeout","saveDraft","autosaveInterval","then","catch","onFieldsChange","axios","resp","draftDate","isDraft","window","location","href","endsWith","history","replaceState","preview","replace","closePreview","revert","pub","url","insertImages","images","imgsHtml","i","urlMedium","alt","caption","viewFragment","processor","toView","modelFragment","toModel","model","insertContent","selection","titleEnter","toast","toastError"],"mappings":"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","sourcesContent":["ï»¿var app = new Vue({\r\n    el: '#app',\r\n    mixins: [blogComposeMixin],\r\n    data: () => ({\r\n        pubClicked: false,\r\n        pubText: '',\r\n        saveVisible: false,\r\n        saveDisabled: false,\r\n        saveText: 'Save',\r\n        closing: true,\r\n        fieldChanged: false,\r\n        drawer: null,\r\n        panel: [true, true, true],\r\n        menuDate: false,\r\n        mediaDialogVisible: false,\r\n        previewUrl: null,\r\n        postUrl: null,\r\n        previewDialogVisible: false,\r\n        progressVisible: false,\r\n        editor: null,\r\n        snackbar: {\r\n            show: false,\r\n            text: '',\r\n            color: '',\r\n        },\r\n    }),\r\n    computed: {\r\n        disablePubButton() {\r\n            return this.post.title.trim().length <= 0 || this.pubClicked;\r\n        },\r\n        tok: function () {\r\n            return document.querySelector('input[name=\"__RequestVerificationToken\"][type=\"hidden\"]').value;\r\n        },\r\n        headers() {\r\n            return { headers: { 'XSRF-TOKEN': this.tok } };\r\n        },\r\n        payload: function () {\r\n            return {\r\n                id: this.post.id,\r\n                postDate: this.post.postDate,\r\n                categoryId: this.post.categoryId,\r\n                tags: this.post.tags,\r\n                slug: this.post.slug,\r\n                excerpt: this.post.excerpt,\r\n                title: this.post.title,\r\n                body: this.editor.getData(),\r\n            }\r\n        },\r\n    },\r\n    mounted() {\r\n        this.pubText = this.post.published ? 'Update' : 'Publish';\r\n        this.initEditor();\r\n    },\r\n    methods: {\r\n        initEditor() {\r\n            let typingTimer;\r\n            let self = this;\r\n            ClassicEditor.create(document.querySelector('#editor'), {\r\n                autosave: {\r\n                    save(editor) {\r\n                        clearTimeout(typingTimer);\r\n                        if (!self.post.published) {\r\n                            self.saveVisible = true;\r\n                            self.saveDisabled = false;\r\n                            self.saveText = 'Save';\r\n                            typingTimer = setTimeout(self.saveDraft, self.autosaveInterval);\r\n                        }\r\n                    }\r\n                }\r\n            })\r\n                .then(editor => {\r\n                    self.editor = editor;\r\n                    console.log('editor initialized: ', self.editor);\r\n                })\r\n                .catch(error => {\r\n                    console.error(error);\r\n                });\r\n        },\r\n        onFieldsChange() {\r\n            this.fieldChanged = true;\r\n            if (this.post.published) return;\r\n            this.saveVisible = true;\r\n            this.saveDisabled = false;\r\n            this.saveText = 'Save';\r\n        },\r\n        saveDraft() {\r\n            console.log('save draft');\r\n            this.saveVisible = true;\r\n            this.saveDisabled = true;\r\n            this.saveText = 'Saving...';\r\n\r\n            console.log('payload: ', this.payload);\r\n            axios.post('/admin/compose?handler=save', this.payload, { headers: { 'XSRF-TOKEN': this.tok } })\r\n                .then(resp => {\r\n                    this.post.id = resp.data.id;\r\n                    this.post.slug = resp.data.slug;\r\n                    this.post.draftDate = resp.data.draftDate;\r\n                    this.post.isDraft = true;\r\n                    if (window.location.href.endsWith('/compose'))\r\n                        history.replaceState({}, null, window.location.href + `/${this.post.id}`);\r\n                })\r\n                .catch(err => { console.log(err); });\r\n\r\n            this.fieldChanged = false;\r\n            this.saveText = 'Saved';\r\n        },\r\n        preview() {\r\n            this.previewDialogVisible = true;\r\n            this.payload.body = this.editor.getData();\r\n            axios.post('/admin/compose?handler=preview', this.payload, { headers: { 'XSRF-TOKEN': this.tok } })\r\n                .then(resp => {\r\n                    this.previewUrl = resp.data;\r\n                    this.postUrl = this.previewUrl.replace('preview/', '');\r\n                })\r\n                .catch(err => { console.log(err); });\r\n        },\r\n        closePreview() {\r\n            this.previewDialogVisible = false;\r\n            this.previewUrl = null;\r\n            this.postUrl = null;\r\n        },\r\n        revert() {\r\n            this.post.published = false;\r\n            this.pubText = this.post.published ? 'Update' : 'Publish';\r\n            this.saveDraft();\r\n        },\r\n        pub() {\r\n            this.closing = false;\r\n            this.pubClicked = true;\r\n            this.pubText = this.post.published ? 'Updating...' : 'Publishing...';\r\n\r\n            const url = this.post.published ? '/admin/compose?handler=update' : '/admin/compose?handler=publish';\r\n            axios.post(url, this.payload, { headers: { 'XSRF-TOKEN': this.tok } })\r\n                .then(resp => {\r\n                    window.location.replace(resp.data);\r\n                })\r\n                .catch(err => { console.log(err); });\r\n        },\r\n        /**\r\n         * Inserts selected images to editor.\r\n         * https://docs.ckeditor.com/ckeditor5/latest/builds/guides/faq.html#where-are-the-editorinserthtml-and-editorinserttext-methods-how-to-insert-some-content\r\n         * https://docs.ckeditor.com/ckeditor5/latest/features/image.html#image-captions\r\n         */\r\n        insertImages(images) {\r\n            console.log(\"selected images to insert: \", images);\r\n            let imgsHtml = '';\r\n            for (var i = 0; i < images.length; i++) {\r\n                imgsHtml += `<figure class=\"image\"><img src=\"${images[i].urlMedium}\" alt=\"${images[i].alt}\" title=\"${images[i].title}\"><figcaption>${images[i].caption}</figcaption></figure>`;\r\n            }\r\n            const viewFragment = this.editor.data.processor.toView(imgsHtml);\r\n            const modelFragment = this.editor.data.toModel(viewFragment);\r\n            this.editor.model.insertContent(modelFragment, this.editor.model.document.selection);\r\n            this.mediaDialogVisible = false;\r\n        },\r\n        titleEnter() {\r\n            this.post.title = this.post.title.replace(/\\n/g, ' ');\r\n        },\r\n        toast(text, color = 'silver') {\r\n            this.snackbar.show = true;\r\n            this.snackbar.text = text;\r\n            this.snackbar.color = color;\r\n        },\r\n        toastError(text) {\r\n            this.snackbar.show = true;\r\n            this.snackbar.text = text;\r\n            this.snackbar.color = 'red';\r\n        },\r\n    },\r\n});"],"file":"blog-compose.js"}