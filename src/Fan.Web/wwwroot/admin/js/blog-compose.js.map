{"version":3,"sources":["../../../Pages/Admin/client/js/blog-compose.js"],"names":["app","Vue","el","mixins","blogComposeMixin","data","pubClicked","pubText","saveVisible","saveDisabled","saveText","closing","fieldChanged","drawer","panel","menuDate","mediaDialogVisible","progressVisible","editor","snackbar","show","text","color","computed","disablePubButton","post","title","trim","length","tok","document","querySelector","value","headers","payload","id","postDate","categoryId","tags","slug","excerpt","body","getData","mounted","published","initEditor","methods","typingTimer","self","ClassicEditor","create","autosave","save","clearTimeout","setTimeout","saveDraft","autosaveInterval","then","catch","onFieldsChange","axios","resp","draftDate","isDraft","window","location","href","endsWith","history","replaceState","revert","pub","url","replace","insertImages","images","imgsHtml","i","urlMedium","alt","caption","viewFragment","processor","toView","modelFragment","toModel","model","insertContent","selection","titleEnter","toast","toastError"],"mappings":"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","sourcesContent":["ï»¿var app = new Vue({\r\n    el: '#app',\r\n    mixins: [blogComposeMixin],\r\n    data: () => ({\r\n        pubClicked: false,\r\n        pubText: '',\r\n        saveVisible: false,\r\n        saveDisabled: false,\r\n        saveText: 'Save',\r\n        closing: true,\r\n        fieldChanged: false,\r\n        drawer: null,\r\n        panel: [true, true, true],\r\n        menuDate: false,\r\n        mediaDialogVisible: false,\r\n        progressVisible: false,\r\n        editor: null,\r\n        snackbar: {\r\n            show: false,\r\n            text: '',\r\n            color: '',\r\n        },\r\n    }),\r\n    computed: {\r\n        disablePubButton() {\r\n            return this.post.title.trim().length <= 0 || this.pubClicked;\r\n        },\r\n        tok: function () {\r\n            return document.querySelector('input[name=\"__RequestVerificationToken\"][type=\"hidden\"]').value;\r\n        },\r\n        headers() {\r\n            return { headers: { 'XSRF-TOKEN': this.tok } };\r\n        },\r\n        payload: function () {\r\n            return {\r\n                id: this.post.id,\r\n                postDate: this.post.postDate,\r\n                categoryId: this.post.categoryId,\r\n                tags: this.post.tags,\r\n                slug: this.post.slug,\r\n                excerpt: this.post.excerpt,\r\n                title: this.post.title,\r\n                body: this.editor.getData(),\r\n            }\r\n        },\r\n    },\r\n    mounted() {\r\n        this.pubText = this.post.published ? 'Update' : 'Publish';\r\n        this.initEditor();\r\n    },\r\n    methods: {\r\n        initEditor() {\r\n            let typingTimer;\r\n            let self = this;\r\n            ClassicEditor.create(document.querySelector('#editor'), {\r\n                autosave: {\r\n                    save(editor) {\r\n                        clearTimeout(typingTimer);\r\n                        if (!self.post.published) {\r\n                            self.saveVisible = true;\r\n                            self.saveDisabled = false;\r\n                            self.saveText = 'Save';\r\n                            typingTimer = setTimeout(self.saveDraft, self.autosaveInterval);\r\n                        }\r\n                    }\r\n                }\r\n            })\r\n                .then(editor => {\r\n                    self.editor = editor;\r\n                    console.log('editor initialized: ', self.editor);\r\n                })\r\n                .catch(error => {\r\n                    console.error(error);\r\n                });\r\n        },\r\n        onFieldsChange() {\r\n            this.fieldChanged = true;\r\n            if (this.post.published) return;\r\n            this.saveVisible = true;\r\n            this.saveDisabled = false;\r\n            this.saveText = 'Save';\r\n        },\r\n        saveDraft() {\r\n            console.log('save draft');\r\n            this.saveVisible = true;\r\n            this.saveDisabled = true;\r\n            this.saveText = 'Saving...';\r\n\r\n            console.log('payload: ', this.payload);\r\n            axios.post('/admin/compose?handler=save', this.payload, { headers: { 'XSRF-TOKEN': this.tok } })\r\n                .then(resp => {\r\n                    this.post.id = resp.data.id;\r\n                    this.post.slug = resp.data.slug;\r\n                    this.post.draftDate = resp.data.draftDate;\r\n                    this.post.isDraft = true;\r\n                    if (window.location.href.endsWith('/compose'))\r\n                        history.replaceState({}, null, window.location.href + `/${this.post.id}`);\r\n                })\r\n                .catch(err => { console.log(err); });\r\n\r\n            this.fieldChanged = false;\r\n            this.saveText = 'Saved';\r\n        },\r\n        revert() {\r\n            this.post.published = false;\r\n            this.pubText = this.post.published ? 'Update' : 'Publish';\r\n            this.saveDraft();\r\n        },\r\n        pub() {\r\n            this.closing = false;\r\n            this.pubClicked = true;\r\n            this.pubText = this.post.published ? 'Updating...' : 'Publishing...';\r\n\r\n            const url = this.post.published ? '/admin/compose?handler=update' : '/admin/compose?handler=publish';\r\n            axios.post(url, this.payload, { headers: { 'XSRF-TOKEN': this.tok } })\r\n                .then(resp => {\r\n                    window.location.replace(resp.data);\r\n                })\r\n                .catch(err => { console.log(err); });\r\n        },\r\n        /**\r\n         * Inserts selected images to editor.\r\n         * https://docs.ckeditor.com/ckeditor5/latest/builds/guides/faq.html#where-are-the-editorinserthtml-and-editorinserttext-methods-how-to-insert-some-content\r\n         * https://docs.ckeditor.com/ckeditor5/latest/features/image.html#image-captions\r\n         */\r\n        insertImages(images) {\r\n            console.log(\"selected images to insert: \", images);\r\n            let imgsHtml = '';\r\n            for (var i = 0; i < images.length; i++) {\r\n                imgsHtml += `<figure class=\"image\"><img src=\"${images[i].urlMedium}\" alt=\"${images[i].alt}\" title=\"${images[i].title}\"><figcaption>${images[i].caption}</figcaption></figure>`;\r\n            }\r\n            const viewFragment = this.editor.data.processor.toView(imgsHtml);\r\n            const modelFragment = this.editor.data.toModel(viewFragment);\r\n            this.editor.model.insertContent(modelFragment, this.editor.model.document.selection);\r\n            this.mediaDialogVisible = false;\r\n        },\r\n        titleEnter() {\r\n            this.post.title = this.post.title.replace(/\\n/g, ' ');\r\n        },\r\n        toast(text, color = 'silver') {\r\n            this.snackbar.show = true;\r\n            this.snackbar.text = text;\r\n            this.snackbar.color = color;\r\n        },\r\n        toastError(text) {\r\n            this.snackbar.show = true;\r\n            this.snackbar.text = text;\r\n            this.snackbar.color = 'red';\r\n        },\r\n    },\r\n});"],"file":"blog-compose.js"}